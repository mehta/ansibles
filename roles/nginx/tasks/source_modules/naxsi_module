# file: roles/nginx/tasks/modules/naxsi_module.yml
# configure flag: --add-module=/tmp/nginx_naxsi


## For DEBIAN nodes
- name: naxsi_module | DEBIAN | download naxsi_module source
  get_url:
    url: "{{nginx_naxsi_url}}"
    dest: "/tmp/nginx-naxsi-module.tar.gz"
  when: ansible_os_family == 'Debian'

- name: naxsi_module | DEBIAN | unpack naxsi_module source
  command: tar -xvzf /tmp/nginx-naxsi-module.tar.gz chdir=/tmp creates=/tmp/naxsi-{{nginx_naxsi_version}}
  when: ansible_os_family == 'Debian'

- name: naxsi_module | DEBIAN | copy naxsi_module source
  command: sudo cp -R /tmp/naxsi-{{nginx_naxsi_version}}/naxsi_src /tmp/nginx_naxsi
  when: ansible_os_family == 'Debian'

- name: naxsi_module | DEBIAN | create configuration entry for naxsi
  copy:
    src: ../../files/naxsi_core.rules
    dest: "{{ nginx_dir }}/naxsi_core.rules"
    owner: "{{ nginx_user }}"
    group: "{{ nginx_group }}"
    mode: 0644
  when: ansible_os_family == 'Debian'
