# file: nginx/tasks/modules/upload_progress_module.yml
# configure flag: --add-module=/tmp/nginx_upload_progress

# to be completed...


## FOR DEBIAN nodes
- name: upload_progress_module | DEBIAN | download upload_progress_module source
  get_url:
    url: "{{ nginx_upload_progress_url }}"
    dest: "/tmp/nginx-upload-progress-module-{{ nginx_upload_progress_version }}.tar.gz"
    owner: "{{ nginx_user }}"
    group: "{{ nginx_group }}"
    mode: 0644
  when: ansible_os_family == 'Debian'

- name: upload_progress_module | DEBIAN | unpack upload_progress_module source
  command: tar -xvzf /tmp/nginx-upload-progress-module-{{ nginx_upload_progress_version }}.tar.gz chdir=/tmp creates=/tmp/nginx-upload-progress-module-{{ nginx_upload_progress_version }}
  when: ansible_os_family == 'Debian'

- name: upload_progress_module | DEBIAN | copy upload_progress_module source folder
  command: sudo cp -R /tmp/nginx-upload-progress-module-{{ nginx_upload_progress_version }} /tmp/nginx_upload_progress
  when: ansible_os_family == 'Debian'

- name: upload_progress_module | DEBIAN | create configuration entry for upload_progress_module
  template:
    src: ../../templates/modules/upload_progress.j2
    dest: "{{ nginx_dir }}/sites-available/upload_progress"
    owner: "{{ nginx_user }}"
    group: "{{ nginx_group }}"
    mode: 0644
  when: ansible_os_family == 'Debian'
